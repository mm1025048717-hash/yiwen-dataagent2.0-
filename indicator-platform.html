<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>指标管理平台 - 亿问DataAgent</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="process-ui.css">
    <style>
        /* Specific overrides for Indicator Platform */
        .layout-wrapper { display: flex; height: 100vh; width: 100%; background: var(--surface-ground); }
        
        /* Sidebar overrides */
        .layout-sidebar {
            display: flex;
            flex-direction: column;
            width: 240px;
            background: #fff;
            border-right: 1px solid rgba(0,0,0,0.05);
            height: 100%;
        }
        .sidebar-header {
            height: 60px;
            display: flex;
            align-items: center;
            padding: 0 20px;
            font-weight: 600;
            font-size: 18px;
            color: var(--text-color);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        .sidebar-header i { color: var(--primary-color); margin-right: 10px; }

        .layout-main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Content Area */
        .page-content {
            padding: 24px;
            overflow-y: auto;
            height: calc(100vh - 60px);
        }

        /* Metric Card */
        .metric-card {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(0,0,0,0.06);
            transition: all 0.2s;
            cursor: pointer;
            position: relative;
        }
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.08);
            border-color: var(--primary-color);
        }
        .metric-type-tag {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            background: #f3f4f6;
            color: #666;
        }
        .metric-value { font-size: 24px; font-weight: 700; margin: 10px 0; color: var(--text-color); }
        .metric-trend { font-size: 13px; display: flex; align-items: center; gap: 4px; }
        .trend-up { color: #34C759; }
        .trend-down { color: #FF3B30; }

        /* Filter Bar */
        .filter-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            background: #fff;
            padding: 16px;
            border-radius: 12px;
            border: 1px solid rgba(0,0,0,0.05);
            align-items: center;
        }

        /* Status Badges */
        .status-badge-dot {
            width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px;
        }
        .status-online { background-color: #34C759; }
        .status-draft { background-color: #FF9500; }
        .status-offline { background-color: #8E8E93; }

        /* Modal specific */
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: var(--text-secondary); }
        
        /* Data Map Visualization */
        .data-map-container {
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            height: 500px;
            border: 1px solid rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
            overflow: hidden;
        }
        .lineage-select {
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 13px;
            background: #fff;
        }

        /* API Card */
        .api-card {
            background: #1e1e1e;
            color: #fff;
            border-radius: 8px;
            padding: 16px;
            font-family: 'SF Mono', monospace;
            font-size: 13px;
            margin-bottom: 12px;
            position: relative;
        }
        .api-method {
            color: #61dafb;
            font-weight: bold;
            margin-right: 8px;
        }
        .api-path {
            color: #a6e22e;
        }
        .api-copy {
            position: absolute;
            right: 16px;
            top: 16px;
            cursor: pointer;
            opacity: 0.6;
        }
        .api-copy:hover { opacity: 1; }

    </style>
</head>
<body>

    <div class="layout-wrapper">
        <!-- Sidebar -->
        <div class="layout-sidebar">
            <div class="sidebar-header">
                <i class="fas fa-project-diagram"></i>
                <span>指标管理平台</span>
            </div>
            <ul class="sidebar-menu">
                <li class="menu-item" style="margin-bottom: 20px;">
                    <a class="menu-link" href="index.html">
                        <i class="fas fa-arrow-left"></i> <span>返回主应用</span>
                    </a>
                </li>
                <li class="menu-category">概览</li>
                <li class="menu-item">
                    <a class="menu-link active" onclick="switchTab('overview')" id="nav-overview">
                        <i class="fas fa-home"></i> <span>平台概览</span>
                    </a>
                </li>
                
                <li class="menu-category">指标资产</li>
                <li class="menu-item">
                    <a class="menu-link" onclick="switchTab('atomic')" id="nav-atomic">
                        <i class="fas fa-cube"></i> <span>原子指标</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="switchTab('derived')" id="nav-derived">
                        <i class="fas fa-calculator"></i> <span>派生指标</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="switchTab('composite')" id="nav-composite">
                        <i class="fas fa-layer-group"></i> <span>复合指标</span>
                    </a>
                </li>

                <li class="menu-category">维度与模型</li>
                <li class="menu-item">
                    <a class="menu-link" onclick="switchTab('dimensions')" id="nav-dimensions">
                        <i class="fas fa-tags"></i> <span>维度管理</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" onclick="switchTab('models')" id="nav-models">
                        <i class="fas fa-database"></i> <span>数据模型</span>
                    </a>
                </li>

                <li class="menu-category">服务</li>
                <li class="menu-item">
                    <a class="menu-link" onclick="switchTab('api')" id="nav-api">
                        <i class="fas fa-plug"></i> <span>数据服务 API</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Container -->
        <div class="layout-main-container">
            <!-- Topbar -->
            <div class="layout-topbar">
                <div class="topbar-left" style="display: flex; align-items: center; gap: 10px;">
                    <button class="p-button p-button-text" style="color: #333;"><i class="fas fa-bars"></i></button>
                    <span style="font-size: 14px; color: var(--text-secondary);">当前工作空间：</span>
                    <span style="font-weight: 600; font-size: 14px;">默认项目 / 生产环境</span>
                </div>
                <div class="topbar-right">
                    <div class="p-input-icon-left" style="margin-right: 12px;">
                        <i class="fas fa-search"></i>
                        <input type="text" class="p-inputtext" placeholder="全局搜索..." style="width: 200px; border:none; background: #f3f4f6;">
                    </div>
                    <button class="topbar-button"><i class="far fa-bell"></i></button>
                    <div class="user-profile" style="display: flex; align-items: center; gap: 8px; margin-left: 12px;">
                        <div style="width: 32px; height: 32px; background: #007AFF; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">A</div>
                        <span style="font-size:14px; font-weight:500">Admin</span>
                    </div>
                </div>
            </div>

            <!-- Content -->
            <div class="page-content">
                
                <!-- View: Overview -->
                <div id="view-overview" class="tab-view">
                    <div style="margin-bottom: 24px;">
                        <h2 style="margin: 0 0 8px 0;">指标平台概览</h2>
                        <p style="color: var(--text-secondary); margin: 0;">查看可用的指标范围，快速利用这些指标获得数据洞察。派生指标由系统自动维护，原子指标由数据平台团队治理提供。</p>
                    </div>

                    <div class="stats-grid" style="grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px;">
                        <div class="stat-card">
                            <div class="stat-header"><span class="stat-title">指标总数</span><span class="stat-badge info">+5</span></div>
                            <div class="stat-value" id="stat-total-indicators">0</div>
                            <div class="stat-sub">覆盖 12 个业务域</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header"><span class="stat-title">API 调用量</span><span class="stat-badge success">+12%</span></div>
                            <div class="stat-value">8.5M</div>
                            <div class="stat-sub">近 24 小时</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header"><span class="stat-title">待审核指标</span><span class="stat-badge warning">3 Pending</span></div>
                            <div class="stat-value">3</div>
                            <div class="stat-sub">需要您的确认</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header"><span class="stat-title">数据质量分</span></div>
                            <div class="stat-value">98.2</div>
                            <div class="stat-sub">健康状态良好</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">如何快速上手指标平台</div>
                        <div style="display:flex; gap:24px; flex-wrap:wrap; font-size:13px; color:var(--text-secondary);">
                            <div style="flex:1; min-width:220px;">
                                <div style="font-weight:600; margin-bottom:6px;">1. 浏览可用指标</div>
                                <p style="margin:0;">在「原子指标管理」中查看由数据平台/数据基建部门已治理好的原子指标，这些指标可直接用于数据分析，无需关注底层技术细节。</p>
                            </div>
                            <div style="flex:1; min-width:220px;">
                                <div style="font-weight:600; margin-bottom:6px;">2. 使用派生指标（自动生成）</div>
                                <p style="margin:0;">派生指标由系统自动维护和管理，对业务用户透明。您可以直接使用这些指标（如近 7 天 GMV、客单价等）进行数据分析，无需手动创建。</p>
                            </div>
                            <div style="flex:1; min-width:220px;">
                                <div style="font-weight:600; margin-bottom:6px;">3. 调用数据服务 API</div>
                                <p style="margin:0;">在「数据服务 API」中查看可用的指标接口，供报表、看板或业务系统统一调用，快速获得数据洞察。</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View: Atomic Indicators -->
                <div id="view-atomic" class="tab-view hidden">
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h2 style="margin: 0;">原子指标管理</h2>
                        </div>
                        <div style="background: #F0F9FF; border: 1px solid #BAE6FD; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                            <div style="display: flex; gap: 12px; align-items: flex-start;">
                                <i class="fas fa-info-circle" style="color: #0369A1; margin-top: 2px; font-size: 18px;"></i>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: #0369A1; margin-bottom: 6px;">原子指标说明</div>
                                    <div style="font-size: 13px; color: #075985; line-height: 1.6;">
                                        原子指标由<strong>数据平台/数据基建部门</strong>负责治理和提供。这些指标基于核心事实表（如订单、支付、访问日志）配置，包含金额、数量、用户数等基础度量。
                                        <br><br>
                                        <strong>业务部门可直接基于已治理好的原子指标进行数据分析</strong>，无需关注数据源、表结构等技术细节。如需新增或修改原子指标，请联系数据平台团队。
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-bar">
                        <input type="text" class="p-inputtext" placeholder="搜索指标名称/编码..." style="width: 300px;" oninput="filterList('atomic', this.value)">
                        <select class="p-inputtext" style="width: 150px;" onchange="filterListStatus('atomic', this.value)">
                            <option value="">所有状态</option>
                            <option value="online">已上线</option>
                            <option value="offline">已下线</option>
                            <option value="draft">草稿</option>
                        </select>
                    </div>

                    <div class="card">
                        <table class="p-datatable styled-table">
                            <thead>
                                <tr>
                                    <th>指标名称</th>
                                    <th>指标编码</th>
                                    <th>业务口径</th>
                                    <th>所属模型</th>
                                    <th>状态</th>
                                    <th>负责人</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="atomic-list">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                 <!-- View: Derived Indicators -->
                 <div id="view-derived" class="tab-view hidden">
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h2 style="margin: 0;">派生指标</h2>
                        </div>
                        <div style="background: #F0FDF4; border: 1px solid #BBF7D0; border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                            <div style="display: flex; gap: 12px; align-items: flex-start;">
                                <i class="fas fa-magic" style="color: #16A34A; margin-top: 2px; font-size: 18px;"></i>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600; color: #16A34A; margin-bottom: 6px;">自动维护说明</div>
                                    <div style="font-size: 13px; color: #166534; line-height: 1.6;">
                                        在 2.0 版本中，<strong>派生指标由系统自动维护和管理，对业务用户透明</strong>。系统会根据原子指标、时间周期和维度自动生成派生指标（如近 7 天 GMV、昨日客单价等）。
                                        <br><br>
                                        您可以直接使用这些派生指标进行数据分析，无需手动创建或管理。所有派生指标都会自动更新，确保数据的准确性和一致性。
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="filter-bar">
                        <input type="text" class="p-inputtext" placeholder="搜索指标名称..." style="width: 300px;" oninput="filterList('derived', this.value)">
                         <select class="p-inputtext" style="width: 150px;" onchange="filterListStatus('derived', this.value)">
                            <option value="">所有状态</option>
                            <option value="online">已上线</option>
                            <option value="draft">草稿</option>
                        </select>
                    </div>

                    <div class="card">
                        <div style="padding: 16px; background: #FAFAFA; border-bottom: 1px solid #E5E7EB; display: flex; justify-content: space-between; align-items: center;">
                            <div style="font-size: 13px; color: #6B7280;">
                                <i class="fas fa-info-circle" style="margin-right: 6px;"></i>
                                以下派生指标由系统自动生成和维护，可直接使用
                            </div>
                        </div>
                        <table class="p-datatable styled-table">
                            <thead>
                                <tr>
                                    <th>指标名称</th>
                                    <th>原子指标</th>
                                    <th>时间周期</th>
                                    <th>修饰词</th>
                                    <th>维度</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="derived-list">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- View: Composite Indicators -->
                <div id="view-composite" class="tab-view hidden">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">复合指标管理</h2>
                        <button class="p-button" onclick="openIndicatorDrawer('composite')"><i class="fas fa-plus"></i> 新建复合指标</button>
                    </div>
                    
                    <div class="filter-bar">
                        <input type="text" class="p-inputtext" placeholder="搜索指标名称..." style="width: 300px;" oninput="filterList('composite', this.value)">
                    </div>

                    <div class="card">
                         <table class="p-datatable styled-table">
                            <thead>
                                <tr>
                                    <th>指标名称</th>
                                    <th>计算表达式</th>
                                    <th>维度</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="composite-list">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- View: Dimensions -->
                <div id="view-dimensions" class="tab-view hidden">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">维度管理</h2>
                        <button class="p-button" onclick="openDimensionDrawer()"><i class="fas fa-plus"></i> 新建维度</button>
                    </div>
                    <!-- Filter for Dimensions -->
                    <div class="filter-bar">
                        <input type="text" class="p-inputtext" placeholder="搜索维度名称/编码..." style="width: 300px;" oninput="filterDimensions(this.value)">
                    </div>
                    <div class="source-grid" id="dimension-grid">
                        <!-- Dimension Cards Populated by JS -->
                    </div>
                </div>

                <!-- View: Data Models -->
                <div id="view-models" class="tab-view hidden">
                     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">数据模型</h2>
                        <button class="p-button p-button-outlined" onclick="syncMetadata(this)"><i class="fas fa-sync"></i> 同步元数据</button>
                    </div>
                    
                    <!-- Filter for Models -->
                    <div class="filter-bar">
                        <input type="text" class="p-inputtext" placeholder="搜索表名..." style="width: 300px;" oninput="filterModels(this.value)">
                         <select class="p-inputtext" style="width: 150px;" onchange="filterModelsType(this.value)">
                            <option value="">所有类型</option>
                            <option value="事实表">事实表</option>
                            <option value="维度表">维度表</option>
                        </select>
                    </div>

                    <div class="card">
                        <table class="p-datatable styled-table">
                            <thead>
                                <tr>
                                    <th>表名</th>
                                    <th>类型</th>
                                    <th>行数</th>
                                    <th>更新时间</th>
                                    <th>状态</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="model-list">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- View: API -->
                <div id="view-api" class="tab-view hidden">
                     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 style="margin: 0;">数据服务 API</h2>
                        <button class="p-button"><i class="fas fa-plus"></i> 注册 API</button>
                    </div>
                    <div class="card">
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">
                            以下 API 由指标定义自动生成，可直接在业务系统中调用。
                        </p>
                        <div id="api-list">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Drawer: Indicator Editor -->
    <div class="drawer-overlay" id="indicator-drawer">
        <div class="drawer-panel wide">
            <div class="drawer-header">
                <span class="drawer-title" id="drawer-title">新建指标</span>
                <i class="fas fa-times" style="cursor: pointer; font-size: 18px;" onclick="closeDrawer('indicator-drawer')"></i>
            </div>
            <div class="drawer-body">
                <!-- Hidden Input for ID (Edit Mode) -->
                <input type="hidden" id="edit-indicator-id">
                <input type="hidden" id="current-indicator-type">

                <div class="form-section-title">基本信息</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>指标名称 <span style="color:red">*</span></label>
                        <input type="text" class="p-inputtext" id="input-name" placeholder="例如：近7天支付GMV">
                    </div>
                    <div class="form-group">
                        <label>指标编码 <span style="color:red">*</span></label>
                        <input type="text" class="p-inputtext" id="input-code" placeholder="例如：gmv_7d_pay">
                    </div>
                </div>
                <div class="form-group">
                    <label>业务口径描述</label>
                    <textarea class="p-inputtext" id="input-desc" rows="3" placeholder="详细描述该指标的业务含义和计算逻辑..."></textarea>
                </div>

                <div class="form-section-title">技术定义</div>
                
                <!-- Atomic Fields -->
                <div id="fields-atomic" class="type-fields">
                    <div class="form-row">
                        <div class="form-group">
                            <label>数据来源表</label>
                            <select class="p-inputtext" id="input-atomic-table">
                                <option value="fact_orders">fact_orders (订单事实表)</option>
                                <option value="fact_payments">fact_payments (支付事实表)</option>
                                <option value="log_visits">log_visits (访问日志表)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>度量字段</label>
                            <select class="p-inputtext" id="input-atomic-field">
                                <option value="amount">amount (金额)</option>
                                <option value="quantity">quantity (数量)</option>
                                <option value="user_id">user_id (用户ID)</option>
                                <option value="order_id">order_id (订单ID)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>聚合方式</label>
                        <select class="p-inputtext" id="input-atomic-agg">
                            <option value="SUM">SUM (求和)</option>
                            <option value="COUNT">COUNT (计数)</option>
                            <option value="AVG">AVG (平均)</option>
                            <option value="MAX">MAX (最大值)</option>
                            <option value="COUNT_DISTINCT">COUNT_DISTINCT (去重计数)</option>
                        </select>
                    </div>
                </div>

                <!-- Derived Fields -->
                <div id="fields-derived" class="type-fields hidden">
                    <div class="form-row">
                        <div class="form-group">
                            <label>选择原子指标</label>
                            <select class="p-inputtext" id="input-derived-atom">
                                <!-- Populated dynamically -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>时间周期</label>
                            <select class="p-inputtext" id="input-derived-period">
                                <option value="近1天">近1天</option>
                                <option value="近7天">近7天</option>
                                <option value="近30天">近30天</option>
                                <option value="自然月">自然月</option>
                                <option value="自然年">自然年</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>关联维度</label>
                        <div id="input-derived-dims" style="border: 1px solid #D1D1D6; border-radius: 8px; padding: 12px; display: flex; flex-wrap: wrap; gap: 15px;">
                             <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Composite Fields -->
                <div id="fields-composite" class="type-fields hidden">
                    <div class="form-group">
                        <label>计算表达式</label>
                        <div style="margin-bottom: 8px; font-size: 12px; color: #888;">支持 + - * / ( ) 运算。例如: atomic_pay_amt / atomic_uv</div>
                        <input type="text" class="p-inputtext" id="input-composite-expr" placeholder="输入表达式...">
                    </div>
                     <div class="form-group">
                        <label>关联维度</label>
                        <div id="input-composite-dims" style="border: 1px solid #D1D1D6; border-radius: 8px; padding: 12px; display: flex; flex-wrap: wrap; gap: 15px;">
                             <!-- Populated dynamically -->
                        </div>
                    </div>
                </div>

                <div class="form-section-title">权限与管理</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>负责人</label>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 24px; height: 24px; background: #007AFF; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px;">A</div>
                            <span>Admin</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>可见范围</label>
                        <select class="p-inputtext">
                            <option>公开</option>
                            <option>仅部门可见</option>
                            <option>私有</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="drawer-footer">
                <button class="p-button p-button-outlined" onclick="closeDrawer('indicator-drawer')">取消</button>
                <button class="p-button" onclick="saveIndicator()">保存并提交</button>
            </div>
        </div>
    </div>

     <!-- Drawer: Dimension Editor -->
    <div class="drawer-overlay" id="dimension-drawer">
        <div class="drawer-panel">
            <div class="drawer-header">
                <span class="drawer-title">新建维度</span>
                <i class="fas fa-times" style="cursor: pointer; font-size: 18px;" onclick="closeDrawer('dimension-drawer')"></i>
            </div>
            <div class="drawer-body">
                <div class="form-group">
                    <label>维度名称 <span style="color:red">*</span></label>
                    <input type="text" class="p-inputtext" id="dim-name" placeholder="例如：门店维度">
                </div>
                <div class="form-group">
                    <label>维度编码 <span style="color:red">*</span></label>
                    <input type="text" class="p-inputtext" id="dim-code" placeholder="例如：dim_store">
                </div>
                <div class="form-group">
                    <label>类型</label>
                    <select class="p-inputtext" id="dim-type">
                        <option value="common">公共维度 (Common)</option>
                        <option value="business">业务维度 (Business)</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label>关联表</label>
                    <input type="text" class="p-inputtext" id="dim-table" placeholder="例如：dim_store_info">
                </div>
            </div>
            <div class="drawer-footer">
                <button class="p-button p-button-outlined" onclick="closeDrawer('dimension-drawer')">取消</button>
                <button class="p-button" onclick="saveDimension()">保存</button>
            </div>
        </div>
    </div>

    <!-- Modal: General Data Preview -->
    <div class="drawer-overlay" id="preview-modal" style="justify-content: center; align-items: center;">
        <div class="card" style="width: 800px; max-height: 80vh; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
            <div class="drawer-header">
                <div>
                    <div style="font-weight: 600; font-size: 16px;" id="preview-title">数据预览</div>
                    <div style="font-size: 12px; color: var(--text-secondary);" id="preview-subtitle">Top 10 Records</div>
                </div>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeModal('preview-modal')"></i>
            </div>
            <div style="padding: 24px; overflow: auto; background:#fff;">
                <table class="p-datatable preview-table" style="width:100%">
                    <thead id="preview-thead"></thead>
                    <tbody id="preview-tbody"></tbody>
                </table>
            </div>
            <div class="drawer-footer">
                <button class="p-button" onclick="closeModal('preview-modal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- Modal: Lineage View -->
    <div class="drawer-overlay" id="lineage-modal" style="justify-content: center; align-items: center;">
        <div class="card" style="width: 900px; height: 600px; display: flex; flex-direction: column; padding: 0; overflow: hidden;">
            <div class="drawer-header">
                <span style="font-weight: 600; font-size: 16px;">数据血缘</span>
                <i class="fas fa-times" style="cursor: pointer;" onclick="closeModal('lineage-modal')"></i>
            </div>
            <div style="flex:1; background: #f9fafb; position: relative; display:flex; align-items:center; justify-content:center;" id="lineage-container">
                <!-- Dynamic Content -->
            </div>
        </div>
    </div>

    <script src="indicator-platform.js"></script>
</body>
</html>