# 亿问DataAgent 2.0 - 启动指南

## 前置要求

1. 已安装 Node.js (推荐 v16 或更高版本)
2. 已安装 npm

## 快速启动步骤

### 1. 安装依赖

在项目根目录打开终端，执行：

```bash
npm install
```

### 2. 配置API密钥

在项目根目录创建 `.env` 文件，内容如下：

```
DEEPSEEK_API_KEY=sk-e8312e0eae874f2f9122f6aa334f4b3f
PORT=3000
```

**注意**：`.env` 文件已包含在 `.gitignore` 中，不会被提交到代码仓库。

### 3. 启动服务器

```bash
npm start
```

或者使用开发模式（代码修改后自动重启）：

```bash
npm run dev
```

如果看到以下输出，说明服务器启动成功：

```
服务器运行在 http://localhost:3000
DeepSeek API Key: 已配置
```

### 4. 访问应用

在浏览器中打开：**http://localhost:3000**

## 功能说明

### 聊天功能

1. **智能问答界面**：
   - 点击导航栏的"智能问答"进入聊天界面
   - 在输入框中输入问题，按 Enter 发送
   - 系统会调用 DeepSeek API 生成回复

2. **模型选择**：
   - **理科生（Alisa）**：使用 `deepseek-chat` 模型，适合精确、快速的分析
   - **文科生（Nora）**：使用 `deepseek-reasoner` 模型，适合深度思考和语义推理

3. **新建对话**：
   - 点击"新建问答"按钮开始新的对话会话
   - 新会话会清除之前的对话历史

### 仪表盘聊天

在仪表盘界面右侧的聊天面板中，也可以使用 AI 助手进行数据分析。

## API接口

### 聊天接口

- **非流式**：`POST /api/chat`
- **流式**：`POST /api/chat/stream`
- **清除历史**：`POST /api/chat/clear`
- **健康检查**：`GET /api/health`

## 故障排查

### 1. 端口被占用

如果3000端口被占用，可以修改 `.env` 文件中的 `PORT` 值：

```
PORT=3001
```

### 2. API调用失败

- 检查 `.env` 文件中的 API 密钥是否正确
- 检查网络连接
- 查看服务器控制台的错误信息

### 3. 前端无法连接后端

- 确保后端服务器正在运行
- 检查浏览器控制台是否有 CORS 错误
- 确认访问的URL是 `http://localhost:3000`

## 开发说明

### 项目结构

```
├── server.js          # Express后端服务器
├── api-client.js      # 前端API客户端封装
├── script.js          # 前端主要业务逻辑
├── index.html         # 主页面
├── package.json       # 项目依赖配置
└── .env              # 环境变量（需自行创建）
```

### 主要修改

1. **server.js**：新增Express服务器，集成DeepSeek API
2. **api-client.js**：新增前端API调用封装
3. **script.js**：
   - `runSimpleFlow()`：修改为调用真实API
   - `sendDashboardChat()`：修改为调用真实API
   - `startNewChat()`：添加清除对话历史功能

## 下一步

- [ ] 集成数据库存储对话历史
- [ ] 添加用户认证
- [ ] 支持流式响应显示
- [ ] 优化错误处理和重试机制



